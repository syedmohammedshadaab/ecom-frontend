<div class="container mt-5" @pageFade>

  <!-- Toast -->
  <div
    class="toast-container"
    [ngClass]="{
      show: showToast,
      success: toastType === 'success',
      error: toastType === 'error'
    }"
  >
    <div class="toast-content d-flex align-items-center justify-content-between">
      <div class="toast-body">{{ toastMessage }}</div>
      <button
        type="button"
        class="btn-close btn-close-white ms-3"
        (click)="showToast = false"
      ></button>
    </div>
  </div>

  <div class="row">

    <!-- LEFT IMAGE SECTION -->
    <div class="col-md-6 text-center position-relative">
      <div id="perfumeCarousel" class="position-relative">

        <!-- Main Image with fade animation -->
        <img
          @imageFade
          [src]="
            imageList[currentImageIndex] && imageList[currentImageIndex].trim() !== ''
              ? imageList[currentImageIndex]
              : 'https://placehold.co/400x400?text=No+Image'
          "
          class="img-fluid rounded shadow-sm main-preview"
          style="max-width: 100%; height: auto; border-radius: 15px;"
          (click)="previewImage(imageList[currentImageIndex])"
        />

        <!-- Badge -->
        <span
          *ngIf="perfume?.latestLaunch"
          class="badge new-launch-badge position-absolute top-0 end-0 m-3"
        >
          New Launch
        </span>

        <!-- Arrows -->
        <button class="carousel-arrow left-arrow" (click)="prevImage()">
          <i class="bi bi-chevron-left"></i>
        </button>

        <button class="carousel-arrow right-arrow" (click)="nextImage()">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>

      <!-- Thumbnails -->
      <div class="d-flex justify-content-center gap-3 flex-wrap mt-3">
        <img
          *ngFor="let img of imageList; let i = index"
          [src]="img ? img : 'https://placehold.co/85x85?text=No+Image'"
          (click)="setImage(i)"
          class="thumbnail-img rounded shadow-sm"
          [class.selected]="i === currentImageIndex"
          style="width: 85px; height: 85px; object-fit: cover; cursor: pointer;"
        />
      </div>
    </div>

    <!-- RIGHT DETAILS SECTION -->
    <div class="col-md-6 text-start mt-4 mt-md-0" @slideRight>
      <h2 class="fw-bold mb-3">{{ perfume?.name }}</h2>
      <p class="text-muted">{{ perfume?.description }}</p>
      <p><strong>Gender:</strong> {{ perfume?.gender }}</p>
      <p><strong>Price:</strong> {{ perfume?.price | currency : 'INR' }}</p>

      <!-- UPDATED ADD TO CART BUTTON WITH SPINNER -->
      <button
        class="btn btn-outline-primary me-2"
        [disabled]="isAdding"
        (click)="addtocart(perfume)"
      >

        <!-- When NOT loading -->
        <ng-container *ngIf="!isAdding">
          <i class="bi bi-cart-plus me-1"></i> Add to Cart
        </ng-container>

        <!-- When loading -->
        <ng-container *ngIf="isAdding">
          <span class="spinner-border spinner-border-sm me-2"></span>
          Adding...
        </ng-container>

      </button>

      <button class="btn btn-outline-secondary" routerLink="/perfumes">
        <i class="bi bi-arrow-left me-1"></i> Back
      </button>
    </div>
  </div>

  <!-- SIMILAR PERFUMES -->
  <div class="mt-5" *ngIf="similarPerfumes.length > 0">
    <h4 class="fw-bold mb-4 text-center">You may also like</h4>

    <div class="row similar-perfumes-row">
      <div
        class="col-md-3 mb-4"
        *ngFor="let p of similarPerfumes"
        (click)="goToDetails(p.id)"
        @cardFade
        style="cursor: pointer;"
      >
        <div class="card h-100 shadow-sm border-0 hover-card position-relative">

          <span
            *ngIf="p.latestLaunch"
            class="badge new-launch-badge position-absolute top-0 end-0 m-2"
          >
            New Launch
          </span>

          <img
            [src]="p.imageurl || p.imageUrl || 'https://placehold.co/300x300?text=No+Image'"
            class="card-img-top rounded"
            style="height: 250px; object-fit: cover;"
          />

          <div class="card-body text-center">
            <h6 class="fw-semibold">{{ p.name }}</h6>
            <p class="text-muted small mb-1">{{ p.gender }}</p>
            <p class="fw-bold mb-0">{{ p.price | currency : 'INR' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
